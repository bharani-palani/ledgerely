"use strict";(self.webpackChunkledgerely_com=self.webpackChunkledgerely_com||[]).push([[1770],{1770:(e,t,s)=>{s.r(t),s.d(t,{default:()=>E});var a=s(9950),n=s(246),r=s(6781),i=s(8459),o=s(5623),l=s(7937),d=s(5342),c=s(3302),m=s(1432),u=s(9288),h=s(3027),f=s(68),p=s(8002),g=s(7956),x=s(2436),b=s(4570),v=s(2016);const y=function(e,t){const s=(0,a.useRef)(!1),[n,r]=(0,a.useState)({top:t.y,left:t.x,rotate:t.z,width:t.props.width,height:t.props.height}),i=(0,a.useRef)({startX:0,startY:0,lastX:t.x,lastY:t.y});return(0,a.useEffect)((()=>{const t=document.getElementById(e);if(!t)throw new Error("Element with given id doesn't exist");const a=t.parentElement;if(!a)throw new Error("target element must have a parent");const n=async e=>{s.current=!0,i.current.startX=e.clientX,i.current.startY=e.clientY;[...e.target.classList].includes("resizeHandle")&&d(e)},o=async e=>{s.current=!1,i.current.lastX=t.offsetLeft,i.current.lastY=t.offsetTop},l=async e=>{if(s.current){const t=[...e.target.classList];t.includes("rotateHandle")||t.includes("resizeHandle")||c(e),t.includes("rotateHandle")&&m(e)}},d=async e=>{const s=e.target.parentElement.clientWidth,a=e.target.parentElement.clientHeight,n=e.pageX,i=e.pageY,o=e=>{const o=s-n+e.pageX,l=a-i+e.pageY;o<=v.Pb.maxWidth&&o>=v.Pb.minWidth&&l<=v.Pb.maxHeight&&l>=v.Pb.minHeight&&(t.style.width=`${o}px`,t.style.height=`${l}px`,r((e=>({...e,width:o,height:l}))))},l=()=>{document.body.removeEventListener("mousemove",o),document.body.removeEventListener("mouseup",l)};document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",l)},c=async e=>{const s=e.clientX-i.current.startX+i.current.lastX,a=e.clientY-i.current.startY+i.current.lastY;t.style.top=`${a}px`,t.style.left=`${s}px`,r((e=>({...e,top:a,left:s})))},m=async e=>{const s=t.getBoundingClientRect(),a=s.left+s.width/2,n=s.top+s.height/2,i=Math.atan2(e.pageX-a,-(e.pageY-n))*(180/Math.PI);t.style.transform=`rotate(${i}deg)`,r((e=>({...e,rotate:i})))},u=async()=>{s.current=!1};t.addEventListener("mousedown",n),t.addEventListener("mouseup",o),t.addEventListener("mouseout",u),a.addEventListener("mousemove",l),a.addEventListener("mouseleave",o);return()=>{t.removeEventListener("mousedown",n),t.removeEventListener("mouseup",o),t.removeEventListener("mouseout",u),a.removeEventListener("mousemove",l),a.removeEventListener("mouseleave",o)}}),[e]),[n,r]};var j=s(5491),k=s.n(j),w=s(4414);const N=e=>{let{id:t,children:s,catId:n}=e;const r=(0,a.useContext)(f.A),{activeChart:i,deleteChart:o}=r;return(0,w.jsxs)(w.Fragment,{children:[i===t&&(0,w.jsxs)(w.Fragment,{children:[["SHAPES","EMOJI"].includes(v.XD[n])&&(0,w.jsx)("i",{className:"fa fa-times-circle position-absolute top-0 start-100 translate-middle text-danger heightHandle cursor-pointer",style:{zIndex:10},onClick:()=>o(t)}),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("i",{className:"fa fa-repeat fa-2x position-absolute icon-bni draggable rotateHandle",style:{left:"calc(50% - 5px)",top:"-40px"}}),!["EMOJI"].includes(v.XD[n])&&(0,w.jsx)("i",{className:"fa fa-arrows-h fa-rotate-90 position-absolute icon-bni draggable resizeHandle",style:{transform:"rotate(45deg)",zIndex:10,right:"-15px",bottom:"-15px"}})]})]}),s]})},M=e=>{var t;let{id:s,Component:n,chartObject:r}=e;const i=(0,u.A)(),[o]=y(s,r),l=(0,a.useContext)(f.A),{theme:d,activeSheet:c,sheets:m,setSheets:h,activeChart:p,setActiveChart:g,deleteChart:x,cloneChart:b,setFile:j}=l,[M,A]=(0,a.useState)(!1),S=(0,a.useRef)(null);(0,a.useEffect)((()=>{M||null==document.fullscreenElement||document.exitFullscreen()}),[M]);const C=(0,a.useCallback)(k()((e=>{h(e)}),300),[]);(0,a.useEffect)((()=>{const e=m.map((e=>(e.id===c&&(e.charts=e.charts.map((e=>(e.id===s&&(e={...e,x:o.left,y:o.top,z:o.rotate,props:{...e.props,width:o.width,height:o.height-(["SHAPES","EMOJI"].includes(v.XD[Number(e.catId)]),0)}}),e)))),e)));C(e,o)}),[o,s]);return(0,w.jsx)("div",{id:s,className:`position-absolute rounded bg-transparent ${d} ${p===s?"highlightedChart":""}`,onClick:()=>g(r.id),style:{top:r.y,left:r.x,transform:`rotate(${r.z}deg)`},children:["SHAPES","EMOJI"].includes(v.XD[r.catId])?(0,w.jsx)(N,{id:r.id,catId:r.catId,children:(0,w.jsx)(n,{...r.props,id:r.id})}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:`d-flex column-gap-2 align-items-center justify-content-between bni-bg text-${"dark"===d?"black":"white"} p-1 ${r.visibility?"rounded-top":"rounded"}`,ref:S,children:[(0,w.jsx)("span",{style:{maxWidth:(null===r||void 0===r||null===(t=r.props)||void 0===t?void 0:t.width)/3+"px"||"150px"},className:"pe-2 small d-inline-block text-nowrap overflow-hidden text-truncate",title:r.props.name,children:r.props.name}),(0,w.jsx)("span",{className:"shape draggable",children:new Array(20).fill("").join(":")}),(0,w.jsxs)("span",{children:[(0,w.jsx)("i",{onClick:()=>b(r),title:i.formatMessage({id:"clone",defaultMessage:"clone"}),className:"fa fa-clipboard cursor-pointer me-2"}),M?(0,w.jsx)("i",{onClick:()=>A(!1),title:i.formatMessage({id:"closeFullScreen",defaultMessage:"closeFullScreen"}),className:"fa fa-stop-circle cursor-pointer me-2"}):(0,w.jsx)("i",{onClick:()=>{var e;A(!0),(e=document.getElementById(`${s}`)).requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},title:i.formatMessage({id:"fullScreen",defaultMessage:"fullScreen"}),className:"fa fa-play-circle cursor-pointer me-2"}),(0,w.jsx)("i",{onClick:()=>(e=>{const t=m.map((t=>(t.id===c&&(t.charts=t.charts.map((t=>(t.id===e&&(t={...t,visibility:!t.visibility}),t)))),t)));h(t),j((e=>({...e,isSaved:!1})))})(r.id),title:r.visibility?i.formatMessage({id:"minimize",defaultMessage:"minimize"}):i.formatMessage({id:"maximize",defaultMessage:"maximize"}),className:`fa fa-${r.visibility?"minus":"plus"}-circle cursor-pointer me-2`}),(0,w.jsx)("i",{onClick:()=>x(r.id),title:i.formatMessage({id:"confirmDelete",defaultMessage:"confirmDelete"}),className:"fa fa-times-circle cursor-pointer"})]})]}),(0,w.jsx)("div",{className:`border border-1 border-top-0 border-${"dark"===d?"black":"grey"} rounded-bottom`,children:(0,w.jsx)(N,{id:r.id,catId:r.catId,children:r.visibility&&(0,w.jsx)(n,{...r.props})})})]})})};var A=s(9845),S=s(6731),C=s(9595);const E=()=>{var e,t,s,y;const j=(0,u.A)(),k=(0,a.useContext)(f.A),N=(0,a.useContext)(x.R),E=(0,a.useContext)(A.O),F=Object.keys(p).reduce(((e,t)=>({...e,[t]:p[t]})),{}),{theme:I,activeSheet:$,setActiveSheet:D,defaultSheet:R,sheets:z,setSheets:L,activeChart:W,setActiveChart:H,workbookRef:T,file:q,setFile:X,saveLoading:O,setSaveLoading:Y,savedWorkbooks:_,setSavedWorkbooks:J}=k,[B,P]=(0,a.useState)(!0),[G,K]=(0,a.useState)(0),Q=(0,a.useRef)(null),U=(0,a.useRef)(null),[V,Z]=(0,a.useState)({width:null===U||void 0===U||null===(e=U.current)||void 0===e?void 0:e.clientWidth,height:null===U||void 0===U||null===(t=U.current)||void 0===t?void 0:t.clientHeight}),ee=()=>{Y(!0);const e=new FormData;e.append("appId",N.userConfig.appId),b.A.post("workbook/getSavedWorkbooks",e).then((e=>{let{data:t}=e;J(t.response)})).catch((e=>N.renderToast({type:"error",icon:"fa fa-times-circle",position:"bottom-center",message:j.formatMessage({id:"unableToReachServer",defaultMessage:"unableToReachServer"})}))).finally((()=>Y(!1)))};(0,a.useEffect)((()=>{var e,t;ee(),Z({width:null===U||void 0===U||null===(e=U.current)||void 0===e?void 0:e.clientWidth,height:null===U||void 0===U||null===(t=U.current)||void 0===t?void 0:t.clientHeight})}),[]),(0,a.useEffect)((()=>{var e;const t=(null===(e=z.filter((e=>e.id===$))[0])||void 0===e?void 0:e.zoom)||100;K(t)}),[z,$]);const te=(0,C.I)(),se={fetch:te.get("fetch"),wbId:te.get("wbId")};(0,a.useEffect)((()=>{if("workbook"===se.fetch&&se.wbId&&_.length>0){const e=new FormData;e.append("id",se.wbId),e.append("appId",N.userConfig.appId),b.A.post("workbook/fetchWorkbookById",e).then((async e=>{let{data:t}=e;const s=JSON.parse(t.response.wb_object);L(s),X((e=>({...e,id:t.response.wb_id,name:t.response.wb_name,isSaved:!0}))),setTimeout((()=>{var e,t,a;D(null===(e=s[0])||void 0===e?void 0:e.id),H(null===(t=s[0])||void 0===t||null===(a=t.charts[0])||void 0===a?void 0:a.id)}),100)})).catch((()=>{}))}}),[JSON.stringify(se),_]);const ae=null===(s=z.filter((e=>e.id===$))[0])||void 0===s?void 0:s.charts,ne=()=>(0,w.jsx)("div",{className:"position-relative",style:{height:"calc(100vh - 200px)"},children:(0,w.jsx)("div",{className:"position-absolute w-100 h-100 d-flex align-items-center justify-content-center",children:(0,w.jsx)("i",{className:"fa fa-circle-o-notch fa-5x fa-spin icon-bni"})})}),re=()=>{Y(!0);const e=new FormData;e.append("id",q.id),e.append("appId",N.userConfig.appId),b.A.post("workbook/deleteWorkbook",e).then((e=>{let{data:t}=e;t.response?(N.renderToast({position:"bottom-center",message:j.formatMessage({id:"workbookSuccessfullyDeleted",defaultMessage:"workbookSuccessfullyDeleted"})}),ee(),ie()):N.renderToast({position:"bottom-center",type:"error",icon:"fa fa-times-circle",message:j.formatMessage({id:"queryDeleteFailed",defaultMessage:"queryDeleteFailed"})})})).catch((e=>{N.renderToast({type:"error",icon:"fa fa-times-circle",message:j.formatMessage({id:"somethingWentWrong",defaultMessage:"somethingWentWrong"})})})).finally((()=>{Y(!1),document.body.click()}))},ie=()=>{L(R),setTimeout((()=>{var e;D(null===(e=R[0])||void 0===e?void 0:e.id),X((e=>({...e,id:null,name:""}))),X((e=>({...e,isSaved:!0})))}),100)};return(0,w.jsxs)("div",{className:"",children:[(0,w.jsx)(r.A,{children:(0,w.jsx)(i.A,{className:""+(W?"pe-5":""),children:(0,w.jsxs)(o.A,{className:"rounded",size:"sm",children:[(0,w.jsx)(l.A,{variant:"",className:`rounded-0 border-start-0 border-${"dark"===I?"secondary":"light"} btn-${I}`,onClick:()=>ie(),title:j.formatMessage({id:"newWorkbook",defaultMessage:"newWorkbook"}),children:(0,w.jsx)("i",{className:"fa fa-book"})}),(0,w.jsxs)(d.A,{children:[(0,w.jsx)(d.A.Toggle,{className:"btn-bni border-"+("dark"===I?"secondary":"light"),children:(0,w.jsx)(h.A,{id:"workbook",defaultMessage:"workbook"})}),(0,w.jsx)(d.A.Menu,{variant:I,className:"overflow-auto",style:{maxHeight:"300px"},children:(null===_||void 0===_?void 0:_.length)>0?_.map(((e,t)=>(0,w.jsxs)(d.A.Item,{as:"div",className:"d-flex align-items-center px-1 py-0 small cursor-pointer",onClick:()=>(e=>{const t=new FormData;t.append("id",e),t.append("appId",N.userConfig.appId),b.A.post("workbook/fetchWorkbookById",t).then((e=>{let{data:t}=e;const s=JSON.parse(t.response.wb_object);L(s),X((e=>({...e,id:t.response.wb_id,name:t.response.wb_name,isSaved:!0}))),setTimeout((()=>{var e,t,a;D(null===(e=s[0])||void 0===e?void 0:e.id),H(null===(t=s[0])||void 0===t||null===(a=t.charts[0])||void 0===a?void 0:a.id)}),100)})).catch((()=>{}))})(e.wb_id),children:[(0,w.jsx)("i",{className:"fa fa-book icon-bni pe-2"}),(0,w.jsx)("div",{className:"small",children:e.wb_name})]},t))):(0,w.jsxs)(d.A.Item,{className:"d-flex align-items-center justify-content-center px-1 py-0 small",children:[(0,w.jsx)("i",{className:"fa fa-exclamation-triangle pe-2"}),(0,w.jsx)("span",{children:(0,w.jsx)(h.A,{id:"noRecordsGenerated",defaultMessage:"noRecordsGenerated"})})]})})]}),(0,w.jsx)(c.A.Control,{className:"border-"+("dark"===I?"secondary":"light"),placeholder:`${j.formatMessage({id:"name",defaultMessage:"name"})}`,onChange:e=>X((t=>({...t,name:e.target.value}))),value:q.name,maxLength:25}),O&&(0,w.jsx)(l.A,{className:"bg-white border-0",children:(0,w.jsx)("i",{className:"fa fa-circle-o-notch fa-spin bni-text"})}),(0,w.jsx)(l.A,{variant:I,className:`border-${"dark"===I?"secondary":"light"} btn-${I} border-end-0`,onClick:()=>(()=>{Y(!0);const e=new FormData,t={...q,sheets:z},s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});e.append("fileData",s),b.A.post("workbook/saveWorkbook",e).then((e=>{let{data:t}=e;null!==t.response&&t.response&&(X((e=>({...e,id:t.response}))),ee(),X((e=>({...e,isSaved:!0}))),N.renderToast({position:"bottom-center",message:j.formatMessage({id:"transactionSavedSuccessfully",defaultMessage:"transactionSavedSuccessfully"})})),null===t.response&&E.setConfig({show:!0,className:"alert-danger border-0 text-dark",type:"danger",dismissible:!0,heading:(0,w.jsx)(S.x,{}),content:(0,w.jsx)(S.E,{})}),null===t.response||t.response||N.renderToast({position:"bottom-center",type:"error",icon:"fa fa-times-circle",message:j.formatMessage({id:"noFormChangeFound",defaultMessage:"noFormChangeFound"})})})).catch((e=>{N.renderToast({type:"error",icon:"fa fa-times-circle",position:"bottom-center",message:j.formatMessage({id:"somethingWentWrong",defaultMessage:"somethingWentWrong"})})})).finally((()=>Y(!1)))})(),disabled:!(q.name&&z.some((e=>e.charts.length>0))),children:(0,w.jsx)("i",{className:"fa fa-save"})}),(0,w.jsx)(m.A,{trigger:"click",placement:"bottom",overlay:(0,w.jsxs)(n.A,{style:{zIndex:1e4},children:[(0,w.jsx)(n.A.Header,{as:"div",className:"bni-bg bni-text py-1 px-2",children:(0,w.jsx)("small",{children:j.formatMessage({id:"confirmDelete",defaultMessage:"confirmDelete"})})}),(0,w.jsxs)(n.A.Body,{style:{columnGap:"5px"},className:"p-1 d-flex align-items-center justify-content-between",children:[(0,w.jsx)("button",{onClick:()=>re(),className:"btn btn-sm btn-danger w-100 py-0",children:j.formatMessage({id:"yes",defaultMessage:"yes"})}),(0,w.jsx)("button",{onClick:()=>document.body.click(),className:"btn btn-sm btn-secondary w-100 py-0",children:j.formatMessage({id:"no",defaultMessage:"no"})})]})]}),rootClose:!0,children:(0,w.jsx)(l.A,{variant:I,className:`border-${"dark"===I?"secondary":"light"} btn-${I} border-end-0`,disabled:!q.id,children:(0,w.jsx)("i",{className:"fa fa-trash"})})}),(0,w.jsx)(m.A,{trigger:"click",placement:"bottom",overlay:(0,w.jsxs)(n.A,{style:{zIndex:1e4},children:[(0,w.jsx)(n.A.Header,{as:"div",className:"bni-bg bni-text py-1 px-2",children:(0,w.jsx)("small",{children:j.formatMessage({id:"info",defaultMessage:"info"})})}),(0,w.jsx)(n.A.Body,{className:"p-1",style:{width:"120px"},children:(0,w.jsxs)(r.A,{children:[(0,w.jsx)(i.A,{xs:8,children:(0,w.jsx)("small",{children:j.formatMessage({id:"sheets",defaultMessage:"sheets"})})}),(0,w.jsx)(i.A,{xs:4,children:(0,w.jsx)("small",{children:z.length})}),(0,w.jsx)(i.A,{xs:8,children:(0,w.jsx)("small",{children:j.formatMessage({id:"charts",defaultMessage:"charts"})})}),(0,w.jsx)(i.A,{xs:4,children:(0,w.jsx)("small",{children:z.map((e=>e.charts.length)).reduce(((e,t)=>e+t),0)})}),(0,w.jsx)(i.A,{xs:12,children:(0,w.jsxs)("small",{children:[j.formatMessage({id:"fileSize",defaultMessage:"fileSize"})," ",(JSON.stringify(z).length/1024).toFixed(2)," Kb"]})})]})})]}),rootClose:!0,children:(0,w.jsx)(l.A,{variant:I,className:`border-${"dark"===I?"secondary":"light"} btn-${I} border-end-0`,style:{padding:"0 12px"},children:(0,w.jsx)("i",{className:"fa fa-info"})})}),(0,w.jsx)(l.A,{variant:I,className:`border-${"dark"===I?"secondary":"light"} btn-${I} border-end-0`,onClick:()=>P(!B),children:(0,w.jsx)("i",{className:"fa fa-th-large"})}),(0,w.jsx)(l.A,{variant:I,className:`border-${"dark"===I?"secondary":"light"} btn-${I} rounded-0`,onClick:()=>{var e;(e=T.current).requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},children:(0,w.jsx)("i",{className:"fa fa-expand"})})]})})}),(0,w.jsx)(a.Suspense,{fallback:(0,w.jsx)(ne,{}),children:(0,w.jsx)("div",{ref:U,className:"overflow-auto",style:{height:`${V.height}px`},children:(0,w.jsx)("div",{ref:Q,style:{zoom:G/100},className:`position-relative chart-container chart-container-${B?I:""} ${null===N||void 0===N||null===(y=N.userConfig)||void 0===y?void 0:y.webMenuType}`,onDrop:e=>(async e=>{if(ae.length<v.e_.chartLimit){const t=Q.current.getBoundingClientRect(),s=JSON.parse(e.dataTransfer.getData("workbookDragData")),a=(0,g.A)(),n=z.map((n=>(n.id===$&&(n.charts=[...n.charts,{...s.chart,id:a,x:e.clientX-t.left,y:e.clientY-t.top,z:0}]),n)));await L(n),await H(a),await X((e=>({...e,isSaved:!1})))}else N.renderToast({type:"warn",icon:"fa fa-exclamation-triangle",position:"bottom-center",message:j.formatMessage({id:"chartLimitExceeded",defaultMessage:"chartLimitExceeded"})})})(e),onDragOver:e=>{e.preventDefault()},onClick:e=>{e.currentTarget===e.target&&H("")},children:(null===ae||void 0===ae?void 0:ae.length)>0?ae.map((e=>{const t=F[e.chartKey];return(0,w.jsx)(M,{id:e.id,Component:t,chartObject:e},e.id)})):(0,w.jsx)("div",{className:"d-flex align-items-center h-100 justify-content-center",children:(0,w.jsx)("kbd",{className:`text-secondary small bg-${I}`,children:(0,w.jsx)(h.A,{id:"startToDragChartsHere",defaultMessage:"startToDragChartsHere"})})})})})})]})}}}]);